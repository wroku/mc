{% extends 'main/base.html' %}

{% block content %}
{% load crispy_forms_tags %}

<div class="row">
<div class="col-4">
    <ul class="list-group">
        <li class="list-group-item text-center"><strong>Ingredients [for {{recipe.servings}} servings]</strong></li>
        {% for ing in quantities %}
            <li class="list-group-item">
                <div class="row">
                    <div class="col-sm-7">{{ing.ingredient}}</div>
                    <div class="col-sm-5">{{ing.quantity}} grams</div>
                </div>
            </li>
        {% endfor %}
    </ul>
    <br>
    <ul class="list-group">
        <li class="list-group-item text-center"><strong>Additional Info</strong></li>
        <li class="list-group-item">
            <div class="row">
                <div class="col-sm-7">Calories per serving:</div>
                <div class="col-sm-5">{{recipe.calories_per_serving}} cal</div>
            </div>
        </li>
        <li class="list-group-item">
            <div class="row">
                <div class="col-sm-7">Price per serving:</div>
                <div class="col-sm-5">{{recipe.price_per_serving}} pln</div>
            </div>
        </li>
        <li class="list-group-item">
            <div class="row">
                <div class="col-sm-7">Preparation time:</div>
                <div class="col-sm-5">{{recipe.preparation_time}} minutes</div>
            </div>
        </li>

    </ul>
    <br>
    <ul class="list-group">
        <li class="list-group-item text-center"><strong>Macronutrients profile</strong></li>
        <li class="list-group-item"><canvas id="myChart" width="10" height="10"></canvas></li>
    </ul>
</div>

<div class="col-8 ">
    <img src="{{recipe.recipe_image.url}}" class="img-fluid mx-auto d-block" >
    <h1>{{recipe.recipe_name}}</h1><small> {{recipe.recipe_posted}}</small>

    {{recipe.directions|safe}}
    <br>
    {% for comment in comments %}
    <div class="comments" style="padding 10px;">
        <p class="font-weight-bold">
            {{comment.user}}
            <span class="text-muted font-weight-normal">
                {{comment.created_on}}
            </span>
        </p>
        {{comment.content|linebreaks}}
    </div>
    {% endfor %}
    <br>

        {% if user.is_authenticated %}
            {% if new_comment %}
            <div class="alert alert-success" role="alert">
                Your comment is awaiting moderation.
            </div>
            {% else %}
            <h4>Leave a comment</h4>
            Share your opinions, experience, advices or let others know about tasty variations of this recipe!
            <form method="post">
                {% csrf_token %}
                {{ comment_form.content|as_crispy_field }}
                <button type="submit" class="btn btn-primary btn-lg">Submit</button>
            </form>
            {% endif %}
        {% else %}
            <h4>Leave a comment</h4>
            <div class="alert alert-info" role="alert">
                <strong>Comments are available for logged users only.</strong> <a href="/login?next={% firstof request.path '/' %}"><strong>Sign in</strong></a> to share your opinion or <a href="/register"><strong>register</strong></a> if you don't have an account yet.
            </div>
        {%  endif %}

    </div>

<script>
var ctx = document.getElementById('myChart').getContext('2d');
var myChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: ['Carbs', 'Fats', 'Proteins'],
        datasets: [{
            label: 'g/100g',
            data: {{nutrients}},
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{

                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});
</script>
</div>
{% endblock %}